
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The documentation for the pynxtools-em plugin.
">
      
      
        <meta name="author" content="The NOMAD Authors">
      
      
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Mapping - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Titillium Web";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#2A4CDF" data-md-color-accent="#008A67">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#contextualization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="header.title">
    <a href="../index.html" title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../assets/nomad-plugin-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mapping
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/FAIRmat-NFDI/pynxtools-em" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../assets/nomad-plugin-logo.png" alt="logo">

    </a>
    Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FAIRmat-NFDI/pynxtools-em" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/installation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/standalone.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Convert electron microscopy data and metadata to NeXus
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-tos/examples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Different usage examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-tos/kikuchi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kikuchi diffraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-tos/mtex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kikuchi diffraction via MTex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-tos/pyxem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kikuchi diffraction via pyxem
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Explanation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Explanation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanation/learn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scope and idea
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanation/implementation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation design
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contextualization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to map pieces of information to NeXus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="conventions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conventions collected with a text file or ELN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eln_and_cfg.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata collected with an ELN and RDM-specific configurations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="zip_png_axon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AXON Protochips Portable Network Graphics PNG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hfive_apex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EDAX APEX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rsciio_gatan.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gatan DigitalMicrograph DM3/DM4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tiff_hitachi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hitachi Tagged Image File Format TIFF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tiff_jeol.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JEOL Tagged Image File Format TIFF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nxs_nion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nion Co. projects with NDATA and HDF5 files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tiff_point.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    point electronic DISS Tagged Image Format TIFF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tiff_tescan.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TESCAN Tagged Image File Format TIFF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tiff_tfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ThermoFisher Tagged Image File Format TIFF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rsciio_velox.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ThermoFisher Velox EMD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tiff_zeiss.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zeiss Tagged Image File Format TIFF
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#contextualization" class="md-nav__link">
    <span class="md-ellipsis">
      Contextualization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-details-about-the-mapping-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Technical details about the mapping approach
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Mapping</h1>

<h2 id="contextualization">Contextualization<a class="headerlink" href="#contextualization" title="Permanent link">&para;</a></h2>
<p>If data models of technology partners would be communicated using tools and methods from the field of semantic technology,
there would be less of a necessity to copy or reformat specific information into files as one could write inference and
information/fact/knowledge retrieval algorithm(s) whereby a specific piece of information that is related to an experiment
or simulation is read directly from the respective file of the technology partner and converted semantically into the
representation that is required on the target side.</p>
<p>The reason why currently this does not work convincingly in cases for many open-source research data management software
is the strong heterogeneity of how granularized pieces of information are expected surplus the observation that contextualization
and documentation, specifically rich and strongly expressive semantic documentation or contextualization, is underdeveloped.</p>
<h2 id="technical-details-about-the-mapping-approach">Technical details about the mapping approach<a class="headerlink" href="#technical-details-about-the-mapping-approach" title="Permanent link">&para;</a></h2>
<p>Mapping information from one serialization format onto another can face various cases of information content,
representation, and formatting mismatch as the data models can differ.
Assume that we wish to map instance data for concepts on the <em>src</em> side, e.g. content stored
from files collected during an measurement, onto instance data for concepts of a different data model
on the <em>trg</em> side. Several cases of mismatch can occur:</p>
<ol>
<li><strong>Mismatch in symbols (aka concept names) used for identifying concepts</strong> An example: <em>high_voltage</em> is expected by <em>trg</em> but <em>HV</em> is used as a symbol by <em>src</em>.</li>
<li><strong>Mismatch in units</strong> An example: <em>trg</em> expects voltage quantities with unit <em>V</em> but <em>src</em> provides unit <em>kV</em>. Another example: <em>trg</em> expects angle as <em>radian</em> but <em>src</em> provides <em>deg</em>.</li>
<li><strong>Mismatch in data types</strong> An example: <em>np.float64</em> is expected by <em>trg</em> but <em>single precision float</em> is used by <em>src</em>. Another example: <em>1</em> as an int is expected by <em>trg</em> but that number has been serialized as a string "1". One more example: <em>trg</em> expects voltage as <em>V</em> but on <em>src</em> tech partners agreed to use SI unit but do not write these unit explicitly.</li>
<li><strong>Mismatch in the granularization of information or different standards used for representing information</strong> An example: <em>trg</em> expects ISO8601 with local time zone offset to UTC but <em>src</em> provides date, time, and timezone as individual strings. Another example: <em>trg</em> expects UNIX timestamp but <em>src</em> provides MS-DOS timestamp.</li>
<li><strong>Mismatch in dimensions</strong> An example: <em>trg</em> requests an (&gt;1,) array but <em>src</em> only provides a scalar</li>
</ol>
<p>Configurations are the solutions which guide the parser how to map instance data for each concept.
Often the mismatch cannot be resolved because the <em>trg</em> and <em>src</em> have not exchanged precisely
defined versions of their data models. In this case, one often uses assumptions.</p>
<p>Configurations implement these assumptions and mapping decisions outside the actual source code
to offer a single place where preferentially such mismatches should be resolved. This enables users
to often avoid having to take a look into the backend code surplus this solutions avoids
that the mapping of potentially many individual concepts becomes too strongly hard-coded and
long mapping pathes need be repeated which would create code bloat.</p>
<p>Configurations should group mapping rules to reduce the overall size of the mapping dictionaries.
Configurations are stored as Python dictionaries with specific formatting.
Configurations use abbreviations wherever possible. All combined, this yields compact
descriptions that are hopefully easier to read and having fewer places where changes
need to be implemented when mapping paths change as the data models evolve.</p>
<p>Mismatch cases 1, 2, 3, 4 are dealt with. Mismatch case 5 is currently ignored.
Instead, instance data from <em>src</em> are copied to <em>trg</em> if no mismatch 1 -4 is observed.
This may cause though that the resulting collection of instance data on the <em>trg</em> side
does not end up fully compliant with an application definition.
However, this is not a problem because verification of the instance data
takes place during consumption of the serialized NeXus artifact/file.</p>
<div class="admonition warning">
<p class="admonition-title">Attention</p>
<p>Remaining paragraphs sketch a draft of the documentation for the technical details of the mapping.</p>
</div>
<p>The following example shows one typical such dictionary.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">AXON_STATIC_STAGE_NX</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="s2">&quot;prefix_trg&quot;</span><span class="p">:</span> <span class="s2">&quot;/ENTRY[entry*]/measurement/instrument/stageID[stage]&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="s2">&quot;prefix_src&quot;</span><span class="p">:</span> <span class="s2">&quot;MicroscopeControlImageMetadata.ActivePositionerSettings.PositionerSettings.[*].Stage.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;design&quot;</span><span class="p">,</span> <span class="s2">&quot;heating_chip&quot;</span><span class="p">)],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">)],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</code></pre></div>
<!--The pint.ureg('') maps on NX_DIMENSIONLESS.-->

<p>In this example the template path for the tuple in <em>use</em> on the <em>trg</em> side will be f"{prefix_trg}/{use[0][0]}" with value use[0][1].
The template path for the tuple in <em>map</em> on the <em>trg</em> side will be f"{prefix_trg}{map[0][0]}" with the value that is read from the <em>src</em> side
pointed to by keyword f"{prefix_src}{map[0][1]}".</p>
<p>Problems with the old algorithm can be exemplified with the following example
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>VELOX_DYNAMIC_STAGE_NX: Dict[str, Any] = {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    &quot;prefix_trg&quot;: &quot;/ENTRY[entry*]/measurement/eventID[event*]/instrument/stageID[stage]&quot;,
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    &quot;use&quot;: [
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        (&quot;tilt1/@units&quot;, &quot;rad&quot;),
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        (&quot;tilt2/@units&quot;, &quot;rad&quot;),
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        (&quot;position/@units&quot;, &quot;m&quot;),
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    ],
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    &quot;map_to_str&quot;: [(&quot;design&quot;, &quot;Stage/HolderType&quot;)],
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    &quot;map_to_real&quot;: [
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        (&quot;tilt1&quot;, &quot;Stage/AlphaTilt&quot;),
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        (&quot;tilt2&quot;, &quot;Stage/BetaTilt&quot;),
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>        (&quot;position&quot;, [&quot;Stage/Position/x&quot;, &quot;Stage/Position/y&quot;, &quot;Stage/Position/z&quot;]),
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    ],
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>}
</code></pre></div></p>
<p>Keywords <em>use</em> and <em>map</em> were looped over. Therefore, template pathes like <em>tilt1/@units</em> were set
independently whether the corresponding value <em>tilt1</em> was found. The new approach solves this
and makes the dictionary more compact:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>VELOX_DYNAMIC_STAGE_NX: Dict[str, Any] = {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    &quot;prefix_trg&quot;: &quot;/ENTRY[entry*]/measurement/eventID[event*]/instrument/stageID[stage]&quot;,
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    &quot;map&quot;: [(&quot;design&quot;, &quot;Stage/HolderType&quot;)],
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    &quot;map_to_float64&quot;: [
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        (&quot;tilt1&quot;, ureg.radiant, &quot;Stage/AlphaTilt&quot;),
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        (&quot;tilt2&quot;, ureg.radiant, &quot;Stage/BetaTilt&quot;),
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        (&quot;position&quot;, ureg.meter, [&quot;Stage/Position/x&quot;, &quot;Stage/Position/y&quot;, &quot;Stage/Position/z&quot;]),
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    ],
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>}
</code></pre></div></p>
<p>The example shows though that it is not necessarily useful to encode all mapping conventions into
such dictionaries. Indeed, if there is a mismatch between the reference frames of <em>src</em> and the one
used for the <em>trg</em> side, an instruction like concatenate the three values <em>Stage/Position/x, y, z</em>
into an array of np.float64 and convert to unit meter may not be sufficient. Offsets or rotations
of the reference frame may also be required. In this case, a more complicated mapping dictionary
is required. We leave this for now as an open issue for the future and implement such as an explicit
mapping and translations as hard-coded instructions instead.</p>
<ul>
<li>Required keyword <strong>prefix_trg</strong> specifies the prefix to use when resolving template paths on the <em>trg</em> side excluding the / separator.</li>
<li>Required keyword <strong>prefix_src</strong> specifies the prefix to use when resolving template paths on the <em>src</em> side including separators.</li>
<li>Optional keywords follow. Each encodes mapping instructions based on one list of tuples as value.</li>
<li><strong>use</strong> instructs mapping explicitly instance data on <em>trg</em> without demanding a <em>src</em>.
    Specifically, tuples of the following two datatypes are allowed:
    (str, str | numpy datatype (scalar or array))
    (str, pint.ureg)
    The first value resolves the symbol for the concept on the <em>trg</em> side.
    The second value resolves the instance data to store on the <em>trg</em> side.
    The template path on the <em>trg</em> side is f"{prefix_trg}/{tpl[0]}", if provided prefix_src will be ignored.</li>
<li>
<p><strong>map</strong> | <strong>map_to_dtype</strong> | <strong>map_to_dtype_and_join</strong> instructs mapping instance data from <em>src</em> on <em>trg</em>.
    Differently typed tuples are allowed that encode compact mapping rules to deal with
    above-mentioned cases of mismatch. The suffix "_to*" is added to solve mismatch 3.
    Mismatch cases 1 and 2 are solved based on how the tuple is structured.
    Mismatch case 3 is solved by adding a suffix like "_to_float64" which will instruct
    that the <em>src</em> data will be mapped if possible from original datatype and precision
    on the numpy datatype and precision specified by <em>dtype</em>.</p>
<p>The suffix <strong>_and_join</strong> will accept a list of below mentioned tuples to concatenate information.</p>
<p>TODO more work needs to be done here</p>
<p>Specifically, tuples of the following datatypes are allowed or a str but in only one case:
* <code>(str, pint.ureg, str | list[str], pint.ureg)</code> aka case five.
  Used in cases of mismatch 1 and 2 with the aim to explicitly convert units between <em>src</em> and <em>trg</em>.</p>
<p>The first value resolves the symbol for the concept on the <em>trg</em> side.
  The second value resolves the specific unit on the <em>trg</em> side.
  The third value resolves the symbol for the concept on the <em>src</em> side.
  The fourth value resolves the specific unit on the <em>src</em> side.</p>
<p>The third value can be a list of strings of symbols for concepts on the <em>src</em> side.
  This is useful for joining individual scalar values in an array,
  like x, y, z coordinates.</p>
<ul>
<li><code>(str, str | list[str], pint.ureg)</code> aka case four.
  Used in cases of mismatch 1 with the aim to accept the unit from the <em>src</em> side.</li>
</ul>
<p>The first value resolves the symbol for the concept on the <em>trg</em> side.
  The second value resolves the symbol for the concept on the <em>src</em> side.
  The third value resolves the specific unit on the <em>src</em> side.</p>
<p>In an implementation, this case can be avoided when the value on the <em>src</em> side
  is already normalized into a pint.ureg. The second value can be a list of
  strings of symbols for concepts on the <em>src</em> side.</p>
<ul>
<li><code>(str, pint.ureg, str | list[str])</code> aka case three.
  Used in cases of mismatch 1 and 2 with the aim to explicitly convert to
  a specific unit on the <em>trg</em> side.</li>
</ul>
<p>The first value resolves the symbol for the concept on the <em>trg</em> side.
  The second value resolves the specific unit on the <em>trg</em> side.
  The third value resolves the symbol for the concept on the <em>src</em> side.</p>
<p>The third value can be a list of strings of symbols for concepts on the <em>src</em> side.
  In an implementation, this case can be avoided when there is another look-up dictionary or
  cache from which the unit to use is defined explicitly.
  The practical issue with NeXus though is that often concepts are constrained
  only as strong as to match a specific unit category, e.g. voltage, i.e. all possible
  units that are convertible into the base unit V.</p>
<p>Therefore, in practice it makes sense to use this case to be specific about
  which unit should be used on the <em>trg</em> side. However, for parsers which cover
  many file formats, like pynxtools-em, this will ask people to add potentially duplicated
  information. In summary, it is best to use a global look-up dictionary for all concepts
  in an application definition and then infer the unit from this dictionary. The actual
  unit conversion is performable then e.g. with pint.</p>
<ul>
<li><code>(str, str | list[str])</code> aka case two.
  Used in cases of mismatch 1. Units on <em>src</em> will be carried over onto the <em>trg</em> side.</li>
</ul>
<p>The first value resolves the symbol for the concept on the <em>trg</em> side.
  The second value resolves the symbol for the concept on the <em>src</em> side.</p>
<p>The second value can be a list of strings of symbols for concepts on the <em>src</em> side.
  This case is an especially useful short-hand notation for concepts with string,
  unitless, dimensionless quantities.</p>
<ul>
<li><code>str</code> aka case one.
  Used in cases when symbols on the <em>trg</em> and <em>src</em> side are the same and
  units should be carried through as is.</li>
</ul>
<p>This case is a further simplification for writing even more compact mapping dictionaries.
  Python allows for a having a mixture of string and tuples in lists.</p>
</li>
</ul>
<!-- * **map_to_iso8601** -->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../javascript.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>